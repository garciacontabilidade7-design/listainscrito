<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Inscritos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
      text-align: center;
    }
    h1 {
      color: #333;
    }
    #total {
      font-size: 18px;
      margin: 10px 0;
      padding: 10px;
      background: #4CAF50;
      color: white;
      border-radius: 8px;
      display: inline-block;
    }
    #erro {
      color: red;
      margin: 10px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #4CAF50;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    #buscar {
      margin: 15px 0;
      padding: 8px;
      width: 90%;
      max-width: 400px;
    }
    button {
      margin: 15px 0;
      padding: 10px 20px;
      background: #2196F3;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #0b7dda;
    }
  </style>
</head>
<body>
  <h1>Lista de Inscritos</h1>
  <div id="total">Total de inscritos: 0</div>
  <div id="erro"></div>
  <input type="text" id="buscar" placeholder="Buscar por nome..." onkeyup="filtrarTabela()">
  <br>
  <button onclick="gerarPDF()">Gerar PDF</button>

  <table id="tabela">
    <thead>
      <tr id="cabecalho"></tr>
    </thead>
    <tbody id="corpo"></tbody>
  </table>

  <script>
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTnvpbDC9xv14rAKgB-smE41QwHhtDzkebvybZXZJI3IPf5CgGIysavUtCNSU2Ju5NYDnru6_iGvPBJ/pub?output=csv";

    async function carregarInscritos() {
      try {
        const response = await fetch(url);
        const data = await response.text();
        const rows = data.split("\n").map(r => r.split(","));

        if (rows.length <= 1) {
          document.getElementById("erro").innerText = "Nenhum inscrito encontrado.";
          return;
        }

        mostrarInscritos(rows);
      } catch (error) {
        console.error("Erro ao carregar inscritos:", error);
        document.getElementById("erro").innerText = "Não foi possível carregar a lista agora. Tente recarregar a página.";
      }
    }

    function mostrarInscritos(rows) {
      const cabecalho = document.getElementById("cabecalho");
      const corpo = document.getElementById("corpo");

      cabecalho.innerHTML = "";
      corpo.innerHTML = "";

      // Cabeçalho
      rows[0].forEach(col => {
        let th = document.createElement("th");
        th.innerText = col.trim();
        cabecalho.appendChild(th);
      });

      // Dados
      for (let i = 1; i < rows.length; i++) {
        if (rows[i].length < 2) continue; 
        let tr = document.createElement("tr");
        rows[i].forEach(col => {
          let td = document.createElement("td");
          td.innerText = col.trim();
          tr.appendChild(td);
        });
        corpo.appendChild(tr);
      }

      // Atualiza total
      document.getElementById("total").innerText = "Total de inscritos: " + (rows.length - 1);
    }

    function filtrarTabela() {
      let input = document.getElementById("buscar").value.toLowerCase();
      let linhas = document.querySelectorAll("#corpo tr");
      linhas.forEach(linha => {
        let texto = linha.innerText.toLowerCase();
        linha.style.display = texto.includes(input) ? "" : "none";
      });
    }

    function gerarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("Lista de Inscritos", 10, 10);

      let linhas = [];
      document.querySelectorAll("#tabela tr").forEach(tr => {
        let linha = [];
        tr.querySelectorAll("th, td").forEach(td => linha.push(td.innerText));
        linhas.push(linha);
      });

      let y = 20;
      linhas.forEach(linha => {
        doc.text(linha.join(" | "), 10, y);
        y += 10;
      });

      doc.save("inscritos.pdf");
    }

    carregarInscritos();
  </script>
</body>
</html>
